<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador PDF - Solicitação Recursal</title>
    <style>
        :root { --primary: #003366; --accent: #28a745; --bg: #eef2f5; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        h1 { text-align: center; color: var(--primary); font-size: 24px; margin-bottom: 10px; }
        p.subtitle { text-align: center; color: #666; font-size: 14px; margin-bottom: 30px; border-bottom: 1px solid #ddd; padding-bottom: 20px; }
        h3 { background: var(--primary); color: white; padding: 12px; font-size: 15px; margin-top: 30px; border-radius: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
        .row { display: flex; gap: 20px; margin-bottom: 15px; flex-wrap: wrap; }
        .col { flex: 1; min-width: 200px; }
        label { display: block; font-weight: 600; font-size: 13px; margin-bottom: 6px; color: #444; }
        input[type="text"], input[type="date"], input[type="number"], select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box; transition: 0.2s; }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 2px rgba(0,51,102,0.1); }
        textarea { resize: vertical; }
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; background: #f8f9fa; padding: 15px; border-radius: 4px; border: 1px solid #e9ecef; }
        .checkbox-item { display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer; }
        input[type="checkbox"], input[type="radio"] { transform: scale(1.1); cursor: pointer; accent-color: var(--primary); }
        button { display: block; width: 100%; padding: 18px; background: var(--accent); color: white; border: none; font-size: 18px; font-weight: bold; border-radius: 6px; cursor: pointer; margin-top: 40px; transition: 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        button:hover { background: #218838; transform: translateY(-1px); }
    </style>
</head>
<body>

<div class="container">
    <h1>Gerador de Solicitação Recursal</h1>
    <p class="subtitle">Preencha os dados abaixo para gerar o PDF formatado conforme padrão Ativos S.A.</p>

    <form id="formRecurso">
        <h3>1. Dados Básicos do Processo</h3>
        <div class="row">
            <div class="col"><label>Pasta CIV:</label><input type="text" id="pasta"></div>
            <div class="col"><label>Cliente:</label><input type="text" id="cliente"></div>
        </div>
        <div class="row">
            <div class="col"><label>Valor originário da Condenação:</label><input type="text" id="valor" placeholder="R$" oninput="calcularEconomia()"></div>
            <div class="col"><label>Verba Honorária:</label><input type="text" id="honoraria" placeholder="%"></div>
        </div>
        <div class="row">
            <div class="col" style="flex: 0 0 auto;">
                <label>Responsabilidade Solidária:</label>
                <div style="display:flex; gap:15px; margin-top:8px;">
                    <label style="font-weight:normal"><input type="radio" name="respSolidaria" value="sim"> Sim</label>
                    <label style="font-weight:normal"><input type="radio" name="respSolidaria" value="nao"> Não</label>
                </div>
            </div>
            <div class="col"><label>Se sim, com quem:</label><input type="text" id="comQuem"></div>
        </div>
        <div class="row">
            <div class="col"><label>Valor estimado de custas recursais:</label><input type="text" id="custas" placeholder="R$"></div>
        </div>
        <div class="row">
            <div class="col"><label>Prazo fatal para interpor o recurso:</label><input type="date" id="prazo" onchange="calcularDiasRestantes()"></div>
            <div class="col"><label>Dias Restantes:</label><input type="number" id="diasRestantes" readonly style="background:#f0f0f0;"></div>
        </div>

        <h3>2. Análise Específica do Caso</h3>
        <div class="row">
            <label>O autor comprovou a inclusão de restrição pela Ativos?</label>
            <div style="margin-left: 20px; display:flex; gap:15px;">
                <label style="font-weight:normal"><input type="radio" name="comprovouInclusao" value="sim"> Sim</label>
                <label style="font-weight:normal"><input type="radio" name="comprovouInclusao" value="nao"> Não</label>
            </div>
        </div>
        
        <label>Por que razão a negativação ou cobrança foi considerada indevida?</label>
        <div class="checkbox-group">
            <label class="checkbox-item"><input type="checkbox" id="motivo1"> Ausência de documentos</label>
            <label class="checkbox-item"><input type="checkbox" id="motivo2"> Pagamento anterior à cessão</label>
            <label class="checkbox-item"><input type="checkbox" id="motivo3"> Dívida prescrita</label>
            <label class="checkbox-item"><input type="checkbox" id="motivo4"> Valor incorreto da dívida</label>
            <label class="checkbox-item"><input type="checkbox" id="motivo5"> Falta de notificação prévia</label>
            <label class="checkbox-item"><input type="checkbox" id="motivo6"> Cessão irregular</label>
            <label class="checkbox-item"><input type="checkbox" id="motivo7"> Outro (Especifique abaixo)</label>
        </div>
        <input type="text" id="motivoOutro" placeholder="Outro motivo..." style="margin-top:10px;">

        <div class="row" style="margin-top:15px;">
            <div class="col">
                <label>Há inscrições preexistentes à da Ativos que não estão sendo questionadas em juízo?</label>
                <div style="display:flex; gap:15px;">
                    <label style="font-weight:normal"><input type="radio" name="inscricoesPre" value="sim"> Sim</label>
                    <label style="font-weight:normal"><input type="radio" name="inscricoesPre" value="nao"> Não</label>
                </div>
            </div>
            <div class="col"><label>Se sim, especificar (Padrão: NÃO HÁ):</label><input type="text" id="especificarInscricoes" value="NÃO HÁ"></div>
        </div>

        <h3>3. Dados Complementares</h3>
        <label>Tipo de restrição realizada pela Ativos:</label>
        <div class="checkbox-group">
            <label class="checkbox-item"><input type="checkbox" id="restricao1"> SPC/Serasa (negativação efetiva)</label>
            <label class="checkbox-item"><input type="checkbox" id="restricao2"> Serasa Limpa Nome/Conta Atrasada</label>
            <label class="checkbox-item"><input type="checkbox" id="restricao3"> Apenas cobrança extrajudicial</label>
            <label class="checkbox-item"><input type="checkbox" id="restricao4"> Outro:</label>
        </div>
        <input type="text" id="restricaoOutro" placeholder="Outro tipo..." style="margin-top:10px;">

        <label style="margin-top:15px;">Valor do dano moral arbitrado está:</label>
        <div class="checkbox-group">
            <label class="checkbox-item"><input type="radio" name="danoMoral" id="dano1"> Dentro dos parâmetros jurisprudenciais</label>
            <label class="checkbox-item"><input type="radio" name="danoMoral" id="dano2"> Acima dos parâmetros usuais</label>
            <label class="checkbox-item"><input type="radio" name="danoMoral" id="dano3"> Significativamente excessivo</label>
        </div>

        <h3>4. Histórico do Caso</h3>
        <label>Resumo das principais alegações e fundamentos da sentença (Máx 2 linhas visualmente):</label>
        <textarea id="resumo" rows="4" placeholder="Digite o resumo aqui..."></textarea>

        <h3>5. Parecer Técnico</h3>
        <div class="row">
            <div class="col">
                <label>Possibilidade de reversão (Mérito):</label>
                <select id="reversao">
                    <option value="" disabled selected>Selecione...</option>
                    <option value="alta">Alta (>70%)</option>
                    <option value="media">Média (30-70%)</option>
                    <option value="baixa">Baixa (<30%)</option>
                </select>
            </div>
            <div class="col">
                <label>Possibilidade de redução (Valor):</label>
                <select id="reducao">
                    <option value="" disabled selected>Selecione...</option>
                    <option value="alta">Alta (>70%)</option>
                    <option value="media">Média (30-70%)</option>
                    <option value="baixa">Baixa (<30%)</option>
                </select>
            </div>
        </div>

        <label>Fundamentos para o Recurso:</label>
        <div class="checkbox-group">
            <label class="checkbox-item"><input type="checkbox" id="fund1"> Valor da condenação acima dos parâmetros jurisprudenciais</label>
            <label class="checkbox-item"><input type="checkbox" id="fund2"> Aplicação da Súmula 385 STJ (negativações preexistentes)</label>
            <label class="checkbox-item"><input type="checkbox" id="fund3"> Ausência de dano moral efetivo</label>
            <label class="checkbox-item"><input type="checkbox" id="fund4"> Cobrança não configura negativação</label>
            <label class="checkbox-item"><input type="checkbox" id="fund5"> Vício processual</label>
            <label class="checkbox-item"><input type="checkbox" id="fund6"> Prescrição da pretensão indenizatória</label>
        </div>
        <input type="text" id="fundOutro" placeholder="Outro fundamento..." style="margin-top:10px;">

        <label style="margin-top:10px;">Estratégia Recursal:</label>
        <div class="checkbox-group">
            <label class="checkbox-item"><input type="checkbox" id="strat1"> Buscar reversão total da sentença</label>
            <label class="checkbox-item"><input type="checkbox" id="strat2"> Buscar apenas minoração do valor</label>
            <label class="checkbox-item"><input type="checkbox" id="strat3"> Aplicar súmula/precedente específico</label>
            <label class="checkbox-item"><input type="checkbox" id="strat4"> Questionar competência/procedimento</label>
        </div>

        <div class="row" style="margin-top:10px;">
            <div class="col"><label>Custo total estimado do recurso (R$):</label><input type="text" id="custoTotal" placeholder="R$ 0,00" oninput="calcularEconomia()"></div>
            <div class="col"><label>Economia potencial máxima (R$):</label><input type="text" id="economia" placeholder="R$ 0,00"></div>
        </div>
        <div class="col">
            <label>Relação custo-benefício:</label>
            <div style="display:flex; gap:15px; margin-top:8px;">
                <label class="checkbox-item"><input type="radio" name="cb" id="cb1"> Favorável</label>
                <label class="checkbox-item"><input type="radio" name="cb" id="cb2"> Desfavorável</label>
                <label class="checkbox-item"><input type="radio" name="cb" id="cb3"> Equilibrada</label>
            </div>
        </div>

        <h3>6. Recomendação Final</h3>
        <div class="checkbox-group">
            <label class="checkbox-item"><input type="radio" name="recFinal" id="rec1"> SOLICITAMOS AUTORIZAÇÃO PARA RECURSO</label>
            <label class="checkbox-item"><input type="radio" name="recFinal" id="rec2"> NÃO RECOMENDAMOS RECURSO</label>
            <label class="checkbox-item"><input type="radio" name="recFinal" id="rec3"> RECURSO CONDICIONAL (especificar condições)</label>
        </div>
        <label style="margin-top:10px;">Justificativa da recomendação:</label>
        <textarea id="justificativa" rows="3" placeholder="Digite a justificativa..."></textarea>

        <h3>7. Anexos Obrigatórios no Sistema Espaider</h3>
        <div class="checkbox-group">
            <label class="checkbox-item"><input type="checkbox" id="anexo1"> Sentença/Acórdão completo</label>
            <label class="checkbox-item"><input type="checkbox" id="anexo2"> Certidão de publicação/intimação</label>
            <label class="checkbox-item"><input type="checkbox" id="anexo3"> Cálculo atualizado da condenação</label>
            <label class="checkbox-item"><input type="checkbox" id="anexo4"> Comprovantes de negativação/cobrança</label>
            <label class="checkbox-item"><input type="checkbox" id="anexo5"> Histórico de restrições do CPF</label>
            <label class="checkbox-item"><input type="checkbox" id="anexo6"> Procuração vigente</label>
            <label class="checkbox-item"><input type="checkbox" id="anexo7"> Jurisprudência aplicável</label>
        </div>

        <h3>8. Responsabilidade</h3>
        <div class="row">
            <div class="col"><label>Advogado Responsável:</label><input type="text" id="advogado" value="MARCOS DELLI RIBEIRO RODRIGUES"></div>
            <div class="col"><label>OAB:</label><input type="text" id="oab" value="5.553"></div>
        </div>
        <div class="row">
            <div class="col"><label>Escritório:</label><input type="text" id="escritorio" value="MDR ADVOCACIA"></div>
            <div class="col"><label>Data:</label><input type="date" id="dataAssinatura"></div>
        </div>

        <button type="button" onclick="gerarPDFComDados()">GERAR PDF PREENCHIDO</button>
    </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
    let logoBase64 = null;

    // Carrega logo e define data atual ao abrir
    window.onload = function() {
        carregarLogoPadrao();
        document.getElementById('dataAssinatura').valueAsDate = new Date();
    };

    function carregarLogoPadrao() {
        const img = new Image();
        img.crossOrigin = "Anonymous";
        img.src = 'logo.png';
        img.onload = function() {
            const canvas = document.createElement("canvas");
            canvas.width = img.width;
            canvas.height = img.height;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0);
            try { logoBase64 = canvas.toDataURL("image/png"); } catch (e) {}
        };
    }

    function calcularDiasRestantes() {
        const prazo = document.getElementById('prazo').value;
        if (prazo) {
            const dataPrazo = new Date(prazo);
            const hoje = new Date();
            hoje.setHours(0,0,0,0);
            dataPrazo.setHours(0,0,0,0);
            const diffDays = Math.ceil((dataPrazo - hoje) / (1000 * 60 * 60 * 24)); 
            document.getElementById('diasRestantes').value = diffDays;
        }
    }

    function formatarDataBR(dataInput) {
        if(!dataInput) return "";
        if(dataInput.includes('-')) {
            const [ano, mes, dia] = dataInput.split('-');
            return `${dia}/${mes}/${ano}`;
        }
        return dataInput;
    }

    function calcularEconomia() {
        // Função auxiliar para limpar e converter texto em número (Formato BR)
        const converterParaNumero = (id) => {
            let valor = document.getElementById(id).value;
            if (!valor) return 0;
            // Remove tudo que não for dígito ou vírgula/ponto, troca ponto de milhar por nada e vírgula por ponto
            valor = valor.replace("R$", "").trim().replaceAll(".", "").replace(",", ".");
            return parseFloat(valor) || 0;
        };

        const valorCondenacao = converterParaNumero('valor');
        const custoRecurso = converterParaNumero('custoTotal');

        // Cálculo: Economia
        const economia = valorCondenacao - custoRecurso;

        // Formata para Real Brasileiro e joga no input
        const formatoMoeda = { style: 'currency', currency: 'BRL' };
        document.getElementById('economia').value = economia.toLocaleString('pt-BR', formatoMoeda);
    }

    function gerarPDFComDados() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
        const margemEsq = 20;
        const larguraUtil = 170;
        const entrelinha = 6;

        // Função para cabeçalho com logo transparente
        const adicionarCabecalho = () => {
            if (logoBase64) {
                doc.setGState(new doc.GState({ opacity: 0.5 }));
                doc.addImage(logoBase64, 'PNG', margemEsq, 10, 40, 15);
                doc.setGState(new doc.GState({ opacity: 1.0 }));
                return 35;
            }
            return 25;
        };

        let y = adicionarCabecalho();
        doc.setFont("times", "normal");

        // --- Helpers ---
        const addSection = (texto) => {
            y += 4;
            doc.setFont("times", "bold");
            doc.setFontSize(12);
            doc.setFillColor(230, 230, 230);
            doc.text(texto.toUpperCase(), margemEsq, y);
            doc.setFont("times", "normal");
            doc.setFontSize(11);
            y += 6;
        };

        const addSubSection = (texto) => {
            doc.setFont("times", "bold");
            doc.setFontSize(11);
            doc.text("• " + texto, margemEsq, y);
            doc.setFont("times", "normal");
            y += entrelinha;
        };

        // Texto em Negrito (Padrão)
        const addField = (label, larguraLinha, xInicial = margemEsq, quebraLinha = true, valorPreenchido = "") => {
            doc.setFont("times", "bold");
            doc.text(label, xInicial, y);
            const larguraTexto = doc.getTextWidth(label);
            const xLinha = xInicial + larguraTexto + 1;
            
            doc.setLineWidth(0.2);
            doc.setDrawColor(50);
            doc.line(xLinha, y + 1, xLinha + larguraLinha, y + 1);

            if (valorPreenchido) {
                doc.setFont("courier", "bold"); 
                doc.setFontSize(10);
                let valorFinal = valorPreenchido;
                if(valorFinal.match(/^\d{4}-\d{2}-\d{2}$/)) valorFinal = formatarDataBR(valorFinal);
                doc.text(String(valorFinal), xLinha + 2, y);
                doc.setFont("times", "normal");
                doc.setFontSize(11);
            }
            return quebraLinha ? (y += entrelinha, margemEsq) : (xLinha + larguraLinha + 5);
        };

        // Texto Normal (Para Seção 1)
        const addFieldNormal = (label, larguraLinha, xInicial = margemEsq, quebraLinha = true, valorPreenchido = "") => {
            doc.setFont("times", "normal");
            doc.text(label, xInicial, y);
            const larguraTexto = doc.getTextWidth(label);
            const xLinha = xInicial + larguraTexto + 1;
            
            doc.setLineWidth(0.2);
            doc.setDrawColor(50);
            doc.line(xLinha, y + 1, xLinha + larguraLinha, y + 1);

            if (valorPreenchido) {
                doc.setFont("courier", "bold"); 
                doc.setFontSize(10);
                let valorFinal = valorPreenchido;
                if(valorFinal.match(/^\d{4}-\d{2}-\d{2}$/)) valorFinal = formatarDataBR(valorFinal);
                doc.text(String(valorFinal), xLinha + 2, y);
                doc.setFont("times", "normal");
                doc.setFontSize(11);
            }
            return quebraLinha ? (y += entrelinha, margemEsq) : (xLinha + larguraLinha + 5);
        };

        const addCheckbox = (label, x, currentY, checked = false) => {
            const size = 3.5;
            doc.setLineWidth(0.2);
            doc.rect(x, currentY - size + 1, size, size);
            if(checked) {
                 doc.setFont("courier", "bold"); 
                 doc.text("X", x + 0.5, currentY);
                 doc.setFont("times", "normal"); 
            }
            doc.text(label, x + size + 2, currentY);
            return x + size + 2 + doc.getTextWidth(label) + 5;
        };

        const addLongText = (texto, linhas = 2) => {
            doc.setFont("courier", "bold");
            doc.setFontSize(10);
            const splitText = doc.splitTextToSize(texto, larguraUtil);
            for(let i=0; i<linhas; i++) {
                doc.setDrawColor(150); 
                doc.line(margemEsq, y + 1, margemEsq + larguraUtil, y + 1);
                if(splitText[i]) doc.text(splitText[i], margemEsq, y);
                y += entrelinha;
            }
            doc.setFont("times", "normal");
            doc.setFontSize(11);
        };

        // --- Geração do Conteúdo ---
        const val = (id) => document.getElementById(id).value;
        const isChecked = (id) => document.getElementById(id).checked;
        const radioVal = (name, checkVal) => {
            const el = document.querySelector(`input[name="${name}"]:checked`);
            return el ? el.value === checkVal : false;
        };
        const radioId = (id) => document.getElementById(id).checked;

        doc.setFont("times", "bold");
        doc.setFontSize(14);
        doc.text("FORMULÁRIO DE SOLICITAÇÃO DE AUTORIZAÇÃO RECURSAL", 105, y, { align: "center" });
        y += 10;

        // Seção 1 (Fonte Normal)
        addSection("1. DADOS BÁSICOS DO PROCESSO");
        let cursorX = margemEsq;
        cursorX = addFieldNormal("Pasta CIV:", 50, cursorX, false, val('pasta'));
        addFieldNormal("Cliente:", 70, cursorX, true, val('cliente'));

        cursorX = margemEsq;
        cursorX = addFieldNormal("Valor originário da Condenação:", 40, cursorX, false, val('valor'));
        addFieldNormal("Verba Honorária:", 40, cursorX, true, val('honoraria'));

        doc.setFont("times", "normal"); 
        doc.text("Responsabilidade Solidária:", margemEsq, y);
        cursorX = margemEsq + doc.getTextWidth("Responsabilidade Solidária:") + 5;
        cursorX = addCheckbox("Sim", cursorX, y, radioVal('respSolidaria', 'sim'));
        addCheckbox("Não", cursorX, y, radioVal('respSolidaria', 'nao'));
        y += entrelinha;

        addFieldNormal("Se sim, com quem:", 120, margemEsq, true, val('comQuem'));
        addFieldNormal("Valor estimado de custas recursais:", 100, margemEsq, true, val('custas'));

        cursorX = margemEsq;
        cursorX = addFieldNormal("Prazo fatal para interpor o recurso:", 30, cursorX, false, val('prazo'));
        
        doc.setFont("times", "normal");
        doc.text("(Dias restantes: ", cursorX, y);
        let wDias = doc.getTextWidth("(Dias restantes: ");
        doc.line(cursorX + wDias, y+1, cursorX + wDias + 10, y+1);
        doc.setFont("courier", "bold"); doc.setFontSize(10);
        doc.text(val('diasRestantes'), cursorX + wDias + 2, y);
        doc.setFont("times", "normal"); doc.setFontSize(11);
        doc.text(")", cursorX + wDias + 11, y);
        y += entrelinha;

        // Seção 2
        addSection("2. ANÁLISE ESPECÍFICA DO CASO");
        doc.text("O autor comprovou a inclusão de restrição pela Ativos?: ", margemEsq, y);
        cursorX = margemEsq + doc.getTextWidth("O autor comprovou a inclusão de restrição pela Ativos?: ") + 2;
        cursorX = addCheckbox("Sim", cursorX, y, radioVal('comprovouInclusao', 'sim'));
        addCheckbox("Não", cursorX, y, radioVal('comprovouInclusao', 'nao'));
        y += entrelinha;

        doc.setFont("times", "bold");
        doc.text("Por que razão a negativação ou cobrança foi considerada indevida?", margemEsq, y);
        y += entrelinha;

        cursorX = margemEsq;
        cursorX = addCheckbox("Ausência de documentos", cursorX, y, isChecked('motivo1'));
        addCheckbox("Pagamento anterior à cessão", cursorX, y, isChecked('motivo2'));
        y += entrelinha;
        cursorX = margemEsq;
        cursorX = addCheckbox("Dívida prescrita", cursorX, y, isChecked('motivo3'));
        addCheckbox("Valor incorreto da dívida", cursorX, y, isChecked('motivo4'));
        y += entrelinha;
        cursorX = margemEsq;
        cursorX = addCheckbox("Falta de notificação prévia", cursorX, y, isChecked('motivo5'));
        addCheckbox("Cessão irregular", cursorX, y, isChecked('motivo6'));
        y += entrelinha;

        cursorX = margemEsq;
        cursorX = addCheckbox("Outro:", cursorX, y, isChecked('motivo7'));
        doc.line(cursorX, y+1, cursorX + 125, y+1);
        if(val('motivoOutro')) {
            doc.setFont("courier", "bold"); doc.setFontSize(10);
            doc.text(val('motivoOutro'), cursorX + 2, y);
            doc.setFont("times", "normal"); doc.setFontSize(11);
        }
        y += entrelinha * 1.5;

        doc.text("Há inscrições preexistentes à da Ativos que não estão sendo questionadas em juízo?", margemEsq, y);
        y += entrelinha;
        cursorX = margemEsq;
        cursorX = addCheckbox("Sim", cursorX, y, radioVal('inscricoesPre', 'sim'));
        addCheckbox("Não", cursorX, y, radioVal('inscricoesPre', 'nao'));
        y += entrelinha;
        
        let textoEspec = val('especificarInscricoes');
        doc.text("Se sim, especificar:", margemEsq, y);
        doc.line(margemEsq + 35, y+1, margemEsq + 170, y+1);
        if(textoEspec) {
             doc.setFont("courier", "bold"); doc.setFontSize(10);
             doc.text(textoEspec, margemEsq + 36, y);
             doc.setFont("times", "normal"); doc.setFontSize(11);
        }
        y += entrelinha;

        // Seção 3
        addSection("3. DADOS COMPLEMENTARES");
        doc.setFont("times", "bold");
        doc.text("Tipo de restrição realizada pela Ativos:", margemEsq, y);
        y += entrelinha;
        addCheckbox("SPC/Serasa (negativação efetiva)", margemEsq, y, isChecked('restricao1'));
        y += entrelinha;
        cursorX = margemEsq;
        cursorX = addCheckbox("Serasa Limpa Nome/Conta Atrasada", cursorX, y, isChecked('restricao2'));
        addCheckbox("Apenas cobrança extrajudicial", cursorX, y, isChecked('restricao3'));
        y += entrelinha;
        cursorX = margemEsq;
        cursorX = addCheckbox("Outro:", cursorX, y, isChecked('restricao4'));
        doc.line(cursorX, y+1, cursorX + 100, y+1);
        if(val('restricaoOutro')) {
             doc.setFont("courier", "bold"); 
             doc.text(val('restricaoOutro'), cursorX + 2, y);
             doc.setFont("times", "normal");
        }
        y += entrelinha * 1.5;

        doc.text("Valor do dano moral arbitrado está:", margemEsq, y);
        y += entrelinha;
        addCheckbox("Dentro dos parâmetros jurisprudenciais", margemEsq, y, radioId('dano1')); y += entrelinha;
        addCheckbox("Acima dos parâmetros usuais", margemEsq, y, radioId('dano2')); y += entrelinha;
        addCheckbox("Significativamente excessivo", margemEsq, y, radioId('dano3')); y += entrelinha;

        // Seção 4
        addSection("4. HISTÓRICO DO CASO");
        doc.text("Resumo das principais alegações e fundamentos da sentença:", margemEsq, y);
        y += entrelinha;
        addLongText(val('resumo'), 3);

        // Seção 5 (Pula página com logo)
        if (y > 250) { doc.addPage(); y = adicionarCabecalho(); }
        addSection("5. PARECER TÉCNICO");
        
        addSubSection("ANÁLISE DE MÉRITO");
        doc.text("Possibilidade de reversão:", margemEsq, y);
        cursorX = margemEsq + 45;
        cursorX = addCheckbox("Alta (>70%)", cursorX, y, val('reversao') === 'alta');
        cursorX = addCheckbox("Média (30-70%)", cursorX, y, val('reversao') === 'media');
        addCheckbox("Baixa (<30%)", cursorX, y, val('reversao') === 'baixa');
        y += entrelinha;

        addSubSection("ANÁLISE DO VALOR");
        doc.text("Possibilidade de redução:", margemEsq, y);
        cursorX = margemEsq + 45;
        cursorX = addCheckbox("Alta (>70%)", cursorX, y, val('reducao') === 'alta');
        cursorX = addCheckbox("Média (30-70%)", cursorX, y, val('reducao') === 'media');
        addCheckbox("Baixa (<30%)", cursorX, y, val('reducao') === 'baixa');
        y += entrelinha * 1.5;

        addSubSection("FUNDAMENTOS PARA O RECURSO");
        addCheckbox("Valor da condenação acima dos parâmetros jurisprudenciais", margemEsq, y, isChecked('fund1')); y += entrelinha;
        addCheckbox("Aplicação da Súmula 385 STJ (negativações preexistentes)", margemEsq, y, isChecked('fund2')); y += entrelinha;
        addCheckbox("Ausência de dano moral efetivo", margemEsq, y, isChecked('fund3')); y += entrelinha;
        addCheckbox("Cobrança não configura negativação", margemEsq, y, isChecked('fund4')); y += entrelinha;
        addCheckbox("Vício processual", margemEsq, y, isChecked('fund5')); y += entrelinha;
        addCheckbox("Prescrição da pretensão indenizatória", margemEsq, y, isChecked('fund6')); y += entrelinha;
        
        cursorX = margemEsq;
        cursorX = addCheckbox("Outro:", cursorX, y, false);
        doc.line(cursorX, y+1, cursorX + 100, y+1);
        if(val('fundOutro')) {
            doc.setFont("courier", "bold"); doc.setFontSize(10);
            doc.text(val('fundOutro'), cursorX + 2, y);
            doc.setFont("times", "normal"); doc.setFontSize(11);
        }

        if (y > 230) { doc.addPage(); y = adicionarCabecalho(); }
        y += entrelinha * 1.5;
        
        addSubSection("ESTRATÉGIA RECURSAL");
        addCheckbox("Buscar reversão total da sentença", margemEsq, y, isChecked('strat1')); y += entrelinha;
        addCheckbox("Buscar apenas minoração do valor", margemEsq, y, isChecked('strat2')); y += entrelinha;
        addCheckbox("Aplicar súmula/precedente específico", margemEsq, y, isChecked('strat3')); y += entrelinha;
        addCheckbox("Questionar competência/procedimento", margemEsq, y, isChecked('strat4'));
        y += entrelinha * 1.5;

        addSubSection("ANÁLISE CUSTO-BENEFÍCIO");
        cursorX = margemEsq;
        cursorX = addField("Custo total estimado do recurso:", 30, cursorX, false, val('custoTotal'));
        cursorX = addField("Economia potencial máxima:", 30, cursorX, false, val('economia'));
        y += entrelinha;
        
        doc.text("Relação custo-benefício:", margemEsq, y);
        cursorX = margemEsq + 50;
        cursorX = addCheckbox("Favorável", cursorX, y, radioId('cb1'));
        cursorX = addCheckbox("Desfavorável", cursorX, y, radioId('cb2'));
        addCheckbox("Equilibrada", cursorX, y, radioId('cb3'));
        y += entrelinha;

        // Seção 6
        addSection("6. RECOMENDAÇÃO FINAL");
        addCheckbox("SOLICITAMOS AUTORIZAÇÃO PARA RECURSO", margemEsq, y, radioId('rec1')); y += entrelinha;
        addCheckbox("NÃO RECOMENDAMOS RECURSO", margemEsq, y, radioId('rec2')); y += entrelinha;
        addCheckbox("RECURSO CONDICIONAL (especificar condições)", margemEsq, y, radioId('rec3')); y += entrelinha;
        
        doc.text("Justificativa da recomendação:", margemEsq, y); y += entrelinha;
        addLongText(val('justificativa'), 2);

        // Seção 7
        addSection("7. ANEXOS OBRIGATÓRIOS NO SISTEMA ESPAIDER");
        doc.setFontSize(10);
        cursorX = margemEsq;
        cursorX = addCheckbox("Sentença/Acórdão completo", cursorX, y, isChecked('anexo1'));
        addCheckbox("Certidão de publicação/intimação", cursorX, y, isChecked('anexo2'));
        y += entrelinha;
        cursorX = margemEsq;
        cursorX = addCheckbox("Cálculo atualizado da condenação", cursorX, y, isChecked('anexo3'));
        addCheckbox("Comprovantes de negativação/cobrança", cursorX, y, isChecked('anexo4'));
        y += entrelinha;
        cursorX = margemEsq;
        addCheckbox("Histórico de restrições do CPF", cursorX, y, isChecked('anexo5'));
        y += entrelinha;
        cursorX = margemEsq;
        cursorX = addCheckbox("Procuração vigente", cursorX, y, isChecked('anexo6'));
        addCheckbox("Jurisprudência aplicável", cursorX, y, isChecked('anexo7'));
        doc.setFontSize(11);
        y += entrelinha * 2;

        // Seção 8
        addSection("8. RESPONSABILIDADE");
        cursorX = margemEsq;
        cursorX = addField("Advogado Responsável:", 70, cursorX, false, val('advogado'));
        addField("OAB/RN:", 20, cursorX, true, val('oab'));
        cursorX = margemEsq;
        cursorX = addField("Escritório:", 60, cursorX, false, val('escritorio'));
        cursorX = addField("Data:", 30, cursorX, false, formatarDataBR(val('dataAssinatura'))); 
        y += entrelinha;
        addField("Assinatura:", 100, margemEsq, true);

        // Rodapé Ativos S.A.
        if (y > 250) { doc.addPage(); y = adicionarCabecalho(); }
        
        y += 5;
        doc.setLineWidth(0.4);
        doc.rect(margemEsq, y, larguraUtil, 40);
        y += 6;
        doc.setFont("times", "bold");
        doc.setFontSize(10);
        doc.text("PARA USO EXCLUSIVO DA ATIVOS S.A.", margemEsq + 2, y);
        y += 7;
        doc.text("Análise GEJUR:", margemEsq + 2, y);
        doc.setFont("times", "normal");
        doc.text("Recebido em: ____/____/_______", margemEsq + 35, y);
        y += 7;
        doc.setFont("times", "bold");
        doc.text("Analisado por:", margemEsq + 2, y);
        doc.setLineWidth(0.2);
        doc.line(margemEsq + 28, y, margemEsq + larguraUtil - 2, y);
        y += 8;
        doc.text("Decisão:", margemEsq + 2, y);
        doc.setFont("times", "normal");
        let checkX = margemEsq + 20;
        doc.rect(checkX, y-3, 3.5, 3.5); doc.text("AUTORIZADO", checkX + 5, y);
        checkX += 35; doc.rect(checkX, y-3, 3.5, 3.5); doc.text("NEGADO", checkX + 5, y);
        checkX += 25; doc.rect(checkX, y-3, 3.5, 3.5); doc.text("SOLICITAR COMPLEMENTAÇÃO", checkX + 5, y);
        y += 8;
        doc.setFont("times", "bold");
        doc.text("Observações:", margemEsq + 2, y);
        y += 1;
        doc.line(margemEsq + 25, y, margemEsq + larguraUtil - 2, y);

        doc.save('Solicitacao_Recursal_Ativos.pdf');
    }
</script>

</body>
</html>